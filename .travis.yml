language: generic
sudo: true
env:
    global:
        # --------------------------------------------------------------------------------------- #
        #                       MODIFY FOR JDK VERSION UPGRADE                                    #
        # --------------------------------------------------------------------------------------- #
        #        
        # JDK Variables used to form the download link
        # Typically the URL looks like
        #
        #       https://github.com/AdoptOpenJDK/openjdk11-binaries/releases/download/jdk-11.0.6%2B10/OpenJDK11U-jdk_x64_linux_hotspot_11.0.6_10.tar.gz
        #
        # Download Version is denoted `11.0.6+10`
        # Download Version PREFIX is `OpenJDK11U`
        # Download REPO is `openjdk11-binaries`
        - JDK_DOWNLOAD_VERSION="11.0.6+10"
        - JDK_DOWNLOAD_VERSION_PREFIX="OpenJDK11U"
        - JDK_DOWNLOAD_REPO="openjdk11-binaries"

        # JDK Version
        # This is available as part of the untar. Untaring the tar results in `jre11.0.6_10`.
        # Removing the prefix `jre` will give this version
        - JDK_VERSION="11.0.6_10"

        # --------------------------------------------------------------------------------------- #
        #                       DO NOT MODIFY FURTHER FOR VERSION UPGRADE                         #
        # --------------------------------------------------------------------------------------- #

        # Name of JDK folder after it is extracted
        - JDK_NAME="jdk-$JDK_DOWNLOAD_VERSION"
        # ECR Url
        - ECR_URL="012629307706.dkr.ecr.us-east-1.amazonaws.com"
        # Base Image Name
        - BASE_IMAGE_NAME="adoptopenjdk-jdk11-base"
        - SERVICE_NAME="$BASE_IMAGE_NAME"
        # Download URL 
        - JDK_DOWNLOAD_URL="$JDK_DOWNLOAD_REPO/releases/download/jdk-$JDK_DOWNLOAD_VERSION/$JDK_DOWNLOAD_VERSION_PREFIX-jdk_x64_linux_hotspot_$JDK_VERSION.tar.gz"

services:
    - docker

before_install:
      # Print Env Variables
    - printf "JDK_DOWNLOAD_VERSION [ $JDK_DOWNLOAD_VERSION ] \n" &&
        printf "JDK_DOWNLOAD_VERSION_PREFIX [ $JDK_DOWNLOAD_VERSION_PREFIX ] \n" &&
        printf "JDK_DOWNLOAD_REPO [ $JDK_DOWNLOAD_REPO ] \n" &&
        printf "JDK_VERSION [ $JDK_VERSION ] \n" &&
        printf "JDK_NAME [ $JDK_NAME ] \n" &&
        printf "BASE_IMAGE_NAME [ $BASE_IMAGE_NAME ] \n" &&
        printf "JDK_DOWNLOAD_URL [ $JDK_DOWNLOAD_URL ] \n"

      # Housekeeping
    - sudo apt-get install  --no-install-recommends -y tree curl python &&
        sudo apt-get clean &&
        sudo rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &&
        sudo pip install awscli
      
      # Download Oracle - tar from the URL
    - curl -vjkL "https://github.com/AdoptOpenJDK/$JDK_DOWNLOAD_URL" > ./java/jdk.tar.gz
    - ls -ltrh ./java


install:
    - cd ./java && docker build -t adoptopenjdk-jdk11-base --build-arg JDK_NAME .

after_success:
    - cd $TRAVIS_BUILD_DIR && ./ci.sh

notifications:
  slack: unbxd:60rvQrHi5prNg8dMCJBVAoZU
